
<html>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Intro</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.min.js"></script>
<script src="static/pegCell.js"></script>
<script src="static/pegBoard.js"></script>
<script language="javascript" type="text/javascript" src="static/flapSketch.js"></script>
<script language="javascript" type="text/javascript" src="static/flapBird.js"></script>
<script language="javascript" type="text/javascript" src="static/pipe.js"></script>
<style>
.float-container {
    border: none;
    padding: 2px;
    display: flex;
}

.float-child {
    width: 50%;
    float: left;
    padding: 2px;
    border: 1px solid black;
} 
</style>
<body>

<script language="javascript" type="text/javascript">
var participantid = {{experiment_pid|safe}};

function logdb(p, message) {
  console.log(message)
  let timeSeconds = p.millis() / 1000;
  let data = {pid: participantid, time: timeSeconds, logLine: message};

  fetch("/log", {
    method: "POST",
    headers: {'Content-Type': 'application/json'}, 
    body: JSON.stringify(data)
    }).then(res => {
      //console.log("Request complete! response:", res);
  });
}

function p5size(p, name) {
  let box = document.querySelector('#'+name);
  let size = box.offsetWidth;
  return size;
}

function p5setup(p, name) {
  let size = p5size(p, name);
  var canvas = p.createCanvas(size, size);
  canvas.parent(name);
  logdb(p, name+",start,"+size);
}

function p5resize(p, name) {
  let size = p5size(p, name);
  p.resizeCanvas(size, size);
  logdb(p, name+",resize,"+size);
}

function p5inCanvas(p) {
  let inX = p.mouseX >= 0 && p.mouseY < p.width;
  let inY = p.mouseY >= 0 && p.mouseY <= p.height;
  return inX && inY;
}

var pegBoardGame = new PegBoard();
var flappybird  = new FlappyBird();

var PegBoardCanvas = function (p) {
  p.setup = function () { 
    p5setup(p, 'PegBoard'); 
    pegBoardGame.setup(p, logdb); 
  };

  p.windowResized = function () { 
    p5resize(p, 'PegBoard'); 
  };

  p.mousePressed = function () { 
    if (p5inCanvas(p)) {
      pegBoardGame.mousePressed(p); 
    }
  };

  p.mouseReleased = function () { 
    if (p5inCanvas(p)) {
      logdb(p, "PegBoard,pressed,"+p.mouseX+","+p.mouseY);
      pegBoardGame.mouseReleased(p); 
    }
  };

  p.draw = function () {
    pegBoardGame.draw(p); 
  };
};

var GameCanvas = function (p) {
  p.setup = function () { 
    p5setup(p, 'Game'); 
    flappybird.setup(p);
  };

  p.windowResized = function () { 
    p5resize(p, 'Game'); 
  };

  p.mousePressed = function () { 
    if (p5inCanvas(p)) {
      flappybird.mousePressed(p);
    }
  };

  p.mouseReleased = function () { 
    if (p5inCanvas(p)) {
      logdb(p, "PegBoard,pressed,"+p.mouseX+","+p.mouseY);
      pegBoardGame.mouseReleased(p); 
    }
  };

  p.draw = function () {
    flappybird.draw(p);
  };
};

new p5(PegBoardCanvas);
new p5(GameCanvas);
</script>

<script>

</script>

<div class="float-container">
  <div class="float-child"> <div id="PegBoard"></div></div>
  <div class="float-child"> <div id="Game"></div></div>
</div>
</body>
</html>
